@if (board) {
  <div class="flex flex-col h-full bg-gray-50 dark:bg-gray-900">
    <!-- Board Header -->
    <div class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-3">
      <div class="flex items-center gap-4">
        <button
          (click)="goBack()"
          class="p-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
          title="Back to boards"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
        </button>
        <div>
          <h1 class="text-xl font-bold text-gray-900 dark:text-white">{{ board.name }}</h1>
          @if (board.description) {
            <p class="text-sm text-gray-500 dark:text-gray-400">{{ board.description }}</p>
          }
        </div>
      </div>
    </div>

    <!-- Board Content -->
    <div class="flex-1 overflow-x-auto overflow-y-hidden p-4">
      <div
        cdkDropListGroup
        class="flex gap-4 h-full items-start"
      >
        <!-- Columns -->
        <div
          cdkDropList
          cdkDropListOrientation="horizontal"
          [cdkDropListData]="columns"
          (cdkDropListDropped)="onColumnDrop($event)"
          class="flex gap-4"
        >
          @for (column of columns; track column.id) {
            <div cdkDrag [cdkDragData]="column">
              <app-column
                [column]="column"
                [connectedLists]="getConnectedLists()"
                (cardDrop)="onCardDrop($event)"
                (cardClick)="openCardModal($event)"
                (cardDelete)="confirmDeleteCard($event)"
                (cardCreate)="onCardCreate($event)"
                (columnUpdate)="onColumnUpdate($event)"
                (columnDelete)="confirmDeleteColumn($event)"
              ></app-column>
            </div>
          }
        </div>

        <!-- Add Column Button -->
        <div class="w-72 shrink-0">
          @if (showAddColumn) {
            <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-3">
              <input
                type="text"
                [(ngModel)]="newColumnName"
                placeholder="Enter column name..."
                class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                (keydown.enter)="addColumn()"
                (keydown.escape)="cancelAddColumn()"
                autofocus
              />
              <div class="flex gap-2 mt-2">
                <button
                  (click)="addColumn()"
                  [disabled]="!newColumnName.trim()"
                  class="px-3 py-1 text-sm bg-primary-600 hover:bg-primary-700 disabled:bg-gray-300 dark:disabled:bg-gray-600 text-white rounded transition-colors"
                >
                  Add Column
                </button>
                <button
                  (click)="cancelAddColumn()"
                  class="px-3 py-1 text-sm text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors"
                >
                  Cancel
                </button>
              </div>
            </div>
          } @else {
            <button
              (click)="showAddColumnForm()"
              class="w-full flex items-center gap-2 px-4 py-3 text-gray-600 dark:text-gray-400 bg-gray-100/50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-700 transition-colors"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
              </svg>
              Add Column
            </button>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Card Modal -->
  @if (selectedCard) {
    <app-card-modal
      [card]="selectedCard"
      [labels]="labels"
      (close)="closeCardModal()"
      (save)="onCardSave($event)"
      (delete)="deleteCard()"
    ></app-card-modal>
  }

  <!-- Delete Card Confirmation -->
  @if (cardToDelete && !selectedCard) {
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50" (click)="cancelDeleteCard()">
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-sm mx-4 p-6" (click)="$event.stopPropagation()">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Delete Card</h2>
        <p class="text-gray-600 dark:text-gray-400 mb-6">
          Are you sure you want to delete "{{ cardToDelete.title }}"? This action cannot be undone.
        </p>

        <div class="flex gap-3 justify-end">
          <button
            (click)="cancelDeleteCard()"
            class="px-4 py-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
          >
            Cancel
          </button>
          <button
            (click)="deleteCard()"
            class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors"
          >
            Delete
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Delete Column Confirmation -->
  @if (columnToDelete) {
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50" (click)="cancelDeleteColumn()">
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-sm mx-4 p-6" (click)="$event.stopPropagation()">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Delete Column</h2>
        <p class="text-gray-600 dark:text-gray-400 mb-6">
          Are you sure you want to delete "{{ columnToDelete.name }}" and all its cards? This action cannot be undone.
        </p>

        <div class="flex gap-3 justify-end">
          <button
            (click)="cancelDeleteColumn()"
            class="px-4 py-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
          >
            Cancel
          </button>
          <button
            (click)="deleteColumn()"
            class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors"
          >
            Delete
          </button>
        </div>
      </div>
    </div>
  }
} @else {
  <div class="flex items-center justify-center h-full bg-gray-50 dark:bg-gray-900">
    <div class="text-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-gray-300 dark:text-gray-600 mb-4 animate-spin" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
      </svg>
      <p class="text-gray-500 dark:text-gray-400">Loading board...</p>
    </div>
  </div>
}
